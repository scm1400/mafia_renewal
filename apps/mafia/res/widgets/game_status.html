<!DOCTYPE html>
<html style="overflow: hidden">

<head>
    <script>
        /* create style sheet */
        const newFontStylePath = document.URL.includes('https://zep.us') ? "https://cdn-static.zep.us/static/zep-script/css/typography.css" : "https://cdn-static-stage.zep.us/static/zep-script/css/typography.css";

        document.head.appendChild(Object.assign(document.createElement("link"), {
            rel: "stylesheet",
            type: "text/css",
            href: newFontStylePath
        }));
    </script>
    <style type="text/css">
        :root {
            --sat: env(safe-area-inset-top);
            --sar: env(safe-area-inset-right);
            --sab: env(safe-area-inset-bottom);
            --sal: env(safe-area-inset-left);
        }

        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            user-select: none !important;
            font-family: 'Pretendard JP', 'Pretendard', sans-serif, Arial;
            color: #27262E;
        }

        html {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 300px;
            max-width: 100%;
            align-items: center;
            height: max-content;
        }

        .status-container {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
        }

        .status-header {
            width: 100%;
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .game-phase {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
            color: #333;
        }

        .day-count {
            font-size: 14px;
            color: #666;
        }

        .timer {
            font-size: 16px;
            font-weight: 600;
            color: #d32f2f;
            margin-bottom: 15px;
        }

        .players-status {
            width: 100%;
            margin-bottom: 15px;
        }

        .status-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            width: 100%;
        }

        .player-status-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 6px;
            background-color: #f5f5f5;
        }

        .player-status-item.dead {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .player-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-size: 16px;
        }

        .player-name {
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .game-info {
            width: 100%;
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .info-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            color: #333;
        }

        .info-content {
            font-size: 14px;
            color: #555;
            line-height: 1.4;
        }

        .my-role {
            width: 100%;
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            cursor: pointer;
        }

        .role-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
            color: white;
        }

        .role-info {
            flex: 1;
        }

        .role-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 2px;
        }

        .role-desc {
            font-size: 12px;
            color: #666;
        }

        /* ì—­í• ë³„ ìƒ‰ìƒ */
        .mafia {
            background-color: #ffebee;
        }

        .mafia .role-title, .mafia .ability-title {
            color: #d32f2f;
        }

        .mafia .role-icon {
            background-color: #d32f2f;
            color: white;
        }

        .police {
            background-color: #e3f2fd;
        }

        .police .role-title, .police .ability-title {
            color: #1976d2;
        }

        .police .role-icon {
            background-color: #1976d2;
            color: white;
        }

        .doctor {
            background-color: #e8f5e9;
        }

        .doctor .role-title, .doctor .ability-title {
            color: #388e3c;
        }

        .doctor .role-icon {
            background-color: #388e3c;
            color: white;
        }

        .citizen {
            background-color: #fffde7;
        }

        .citizen .role-title, .citizen .ability-title {
            color: #fbc02d;
        }

        .citizen .role-icon {
            background-color: #fbc02d;
            color: white;
        }
        
        /* ì¶”ê°€ ì—­í•  ìŠ¤íƒ€ì¼ */
        .spy {
            background-color: #f3e5f5;
        }

        .spy .role-title, .spy .ability-title {
            color: #9c27b0;
        }

        .spy .role-icon {
            background-color: #9c27b0;
            color: white;
        }
        
        .medium {
            background-color: #e0f7fa;
        }

        .medium .role-title, .medium .ability-title {
            color: #00acc1;
        }

        .medium .role-icon {
            background-color: #00acc1;
            color: white;
        }
        
        .soldier {
            background-color: #e8eaf6;
        }

        .soldier .role-title, .soldier .ability-title {
            color: #3f51b5;
        }

        .soldier .role-icon {
            background-color: #3f51b5;
            color: white;
        }
        
        .politician {
            background-color: #efebe9;
        }

        .politician .role-title, .politician .ability-title {
            color: #795548;
        }

        .politician .role-icon {
            background-color: #795548;
            color: white;
        }
        
        .lover {
            background-color: #fce4ec;
        }

        .lover .role-title, .lover .ability-title {
            color: #e91e63;
        }

        .lover .role-icon {
            background-color: #e91e63;
            color: white;
        }
        
        .journalist {
            background-color: #fff3e0;
        }

        .journalist .role-title, .journalist .ability-title {
            color: #ff9800;
        }

        .journalist .role-icon {
            background-color: #ff9800;
            color: white;
        }
        
        .werewolf {
            background-color: #fafafa;
        }

        .werewolf .role-title, .werewolf .ability-title {
            color: #616161;
        }

        .werewolf .role-icon {
            background-color: #616161;
            color: white;
        }
        
        .gangster {
            background-color: #eceff1;
        }

        .gangster .role-title, .gangster .ability-title {
            color: #607d8b;
        }

        .gangster .role-icon {
            background-color: #607d8b;
            color: white;
        }
        
        .detective {
            background-color: #f1f8e9;
        }

        .detective .role-title, .detective .ability-title {
            color: #689f38;
        }

        .detective .role-icon {
            background-color: #689f38;
            color: white;
        }
        
        .gravedigger {
            background-color: #e0f2f1;
        }

        .gravedigger .role-title, .gravedigger .ability-title {
            color: #00897b;
        }

        .gravedigger .role-icon {
            background-color: #00897b;
            color: white;
        }
        
        .terrorist {
            background-color: #f9fbe7;
        }

        .terrorist .role-title, .terrorist .ability-title {
            color: #827717;
        }

        .terrorist .role-icon {
            background-color: #827717;
            color: white;
        }
        
        .madam {
            background-color: #fff1f1;
        }

        .madam .role-title, .madam .ability-title {
            color: #d81b60;
        }

        .madam .role-icon {
            background-color: #d81b60;
            color: white;
        }

        /* ë‹¨ê³„ë³„ ìƒ‰ìƒ */
        .phase-night {
            color: #3f51b5;
        }

        .phase-day {
            color: #ff9800;
        }

        .phase-voting {
            color: #9c27b0;
        }

        .phase-defense {
            color: #607d8b;
        }

        .phase-approval {
            color: #795548;
        }

        /* ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ */
        .mobile {
            width: 100%;
            padding: 10px;
        }

        .mobile .status-container {
            width: 100%;
            padding: 12px;
        }

        .mobile .players-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    </style>
</head>

<body>
    <div class="status-container">
        <div class="status-header">
            <div class="game-phase" id="game-phase">ê²Œì„ ì¤€ë¹„ ì¤‘</div>
            <div class="day-count" id="day-count">ì°¸ê°€ìë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>
        </div>
        <div class="timer" id="timer" style="display: none;">ë‚¨ì€ ì‹œê°„: 30ì´ˆ</div>

        <div class="players-status">
            <div class="status-title">í”Œë ˆì´ì–´ ìƒíƒœ</div>
            <div class="players-grid" id="players-grid">
                <!-- í”Œë ˆì´ì–´ ìƒíƒœê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <div class="game-info">
            <div class="info-title">ê²Œì„ ì •ë³´</div>
            <div class="info-content" id="game-info-content">
                ê²Œì„ì´ ì‹œì‘ë˜ë©´ ì—¬ê¸°ì— í˜„ì¬ ë‹¨ê³„ì— ëŒ€í•œ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
        </div>

        <div class="my-role" id="my-role">
            <div class="role-icon" id="role-icon">?</div>
            <div class="role-info">
                <div class="role-name" id="role-name">ì—­í•  ë¯¸ì •</div>
                <div class="role-desc" id="role-desc">ê²Œì„ì´ ì‹œì‘ë˜ë©´ ì—­í• ì´ ë°°ì •ë©ë‹ˆë‹¤</div>
            </div>
        </div>
    </div>

    <script>
        let gamePhase = "WAITING";
        let dayCount = 0;
        let players = [];
        let myRole = null;
        let myPlayerId = null;
        let remainingTime = 0;
        let timerInterval;
        let serverTime = 0;
        let timeDiff = 0;

        // ì—­í•  ë°ì´í„° ê°ì²´ ì„ ì–¸
        let roleData = {
            "mafia": {
                name: "ë§ˆí”¼ì•„",
                icon: "ğŸ”ª",
                description: "ë°¤ì— ì‹œë¯¼ì„ ì£½ì´ëŠ” ì—­í• ì…ë‹ˆë‹¤.",
                className: "mafia"
            },
            "police": {
                name: "ê²½ì°°",
                icon: "ğŸ”",
                description: "ë°¤ì— í”Œë ˆì´ì–´ì˜ ì—­í• ì„ ì¡°ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                className: "police"
            },
            "doctor": {
                name: "ì˜ì‚¬",
                icon: "ğŸ’‰",
                description: "ë°¤ì— í”Œë ˆì´ì–´ë¥¼ ì¹˜ë£Œí•´ ë§ˆí”¼ì•„ì˜ ê³µê²©ìœ¼ë¡œë¶€í„° ë³´í˜¸í•©ë‹ˆë‹¤.",
                className: "doctor"
            },
            "citizen": {
                name: "ì‹œë¯¼",
                icon: "ğŸ‘¤",
                description: "ë‚®ì— í† ë¡ ì„ í†µí•´ ë§ˆí”¼ì•„ë¥¼ ì°¾ì•„ë‚´ëŠ” ì—­í• ì…ë‹ˆë‹¤.",
                className: "citizen"
            }
        };

        const phaseData = {
            "WAITING": {
                name: "ê²Œì„ ì¤€ë¹„ ì¤‘",
                description: "ì°¸ê°€ìë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘ì…ë‹ˆë‹¤. ìµœì†Œ 4ëª…ì´ ëª¨ì´ë©´ ê²Œì„ì´ ì‹œì‘ë©ë‹ˆë‹¤.",
                className: ""
            },
            "NIGHT": {
                name: "ë°¤ ì‹œê°„",
                description: "ë§ˆí”¼ì•„ëŠ” ì£½ì¼ ì‚¬ëŒì„, ê²½ì°°ì€ ì¡°ì‚¬í•  ì‚¬ëŒì„, ì˜ì‚¬ëŠ” ì‚´ë¦´ ì‚¬ëŒì„ ì„ íƒí•˜ì„¸ìš”.",
                className: "phase-night"
            },
            "DAY": {
                name: "ë‚® ì‹œê°„",
                description: "ë§ˆí”¼ì•„ë¥¼ ì°¾ê¸° ìœ„í•´ í† ë¡ í•˜ì„¸ìš”. ê³§ íˆ¬í‘œê°€ ì‹œì‘ë©ë‹ˆë‹¤.",
                className: "phase-day"
            },
            "VOTING": {
                name: "íˆ¬í‘œ ì‹œê°„",
                description: "ë§ˆí”¼ì•„ë¡œ ì˜ì‹¬ë˜ëŠ” ì‚¬ëŒì—ê²Œ íˆ¬í‘œí•˜ì„¸ìš”.",
                className: "phase-voting"
            },
            "FINAL_DEFENSE": {
                name: "ìµœí›„ ë³€ë¡ ",
                description: "ê°€ì¥ ë§ì€ í‘œë¥¼ ë°›ì€ í”Œë ˆì´ì–´ê°€ ìµœí›„ ë³€ë¡ ì„ í•©ë‹ˆë‹¤.",
                className: "phase-defense"
            },
            "APPROVAL_VOTING": {
                name: "ì°¬ë°˜ íˆ¬í‘œ",
                description: "ìµœí›„ ë³€ë¡ ì„ ë“¤ì€ í›„, ì²˜í˜•ì— ëŒ€í•œ ì°¬ë°˜ íˆ¬í‘œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.",
                className: "phase-approval"
            }
        };

        function updateGamePhase(phase, day) {
            gamePhase = phase;
            dayCount = day;
            
            const phaseInfo = phaseData[phase] || phaseData["WAITING"];
            
            const phaseElement = document.getElementById('game-phase');
            phaseElement.textContent = phaseInfo.name;
            phaseElement.className = `game-phase ${phaseInfo.className}`;
            
            document.getElementById('day-count').textContent = day > 0 ? `${day}ì¼ì°¨` : "ê²Œì„ ì¤€ë¹„ ì¤‘";
            document.getElementById('game-info-content').textContent = phaseInfo.description;
        }

        function updatePlayers(playersList) {
            players = playersList;
            const playersGrid = document.getElementById('players-grid');
            playersGrid.innerHTML = '';
            
            players.forEach(player => {
                const playerItem = document.createElement('div');
                playerItem.className = `player-status-item ${!player.isAlive ? 'dead' : ''}`;
                
                playerItem.innerHTML = `
                    <div class="player-avatar">${player.emoji || 'ğŸ‘¤'}</div>
                    <div class="player-name">${player.name}${player.id === myPlayerId ? ' (ë‚˜)' : ''}</div>
                `;
                
                playersGrid.appendChild(playerItem);
            });
        }

        function updateMyRole(role) {
            console.log("ì—­í•  ì—…ë°ì´íŠ¸:", role);
            myRole = role;
            
            if (!role) {
                document.getElementById('role-name').textContent = "ì—­í•  ë¯¸ì •";
                document.getElementById('role-icon').textContent = "?";
                document.getElementById('role-desc').textContent = "ê²Œì„ì´ ì‹œì‘ë˜ë©´ ì—­í• ì´ ë°°ì •ë©ë‹ˆë‹¤";
                document.getElementById('my-role').className = "my-role";
                return;
            }
            
            document.getElementById('role-name').textContent = role.name;
            document.getElementById('role-icon').textContent = role.icon;
            document.getElementById('role-desc').textContent = role.description;
            document.getElementById('my-role').className = `my-role ${role.id}`;
        }

        function updateTimer(seconds, serverTimestamp) {
            if (seconds <= 0) {
                document.getElementById('timer').style.display = 'none';
                clearInterval(timerInterval);
                return;
            }
            
            // ì„œë²„ ì‹œê°„ê³¼ í´ë¼ì´ì–¸íŠ¸ ì‹œê°„ì˜ ì°¨ì´ ê³„ì‚°
            if (serverTimestamp) {
                const clientTime = Date.now();
                serverTime = serverTimestamp;
                timeDiff = clientTime - serverTime;
                console.log("ì„œë²„ ì‹œê°„:", serverTime, "í´ë¼ì´ì–¸íŠ¸ ì‹œê°„:", clientTime, "ì‹œê°„ ì°¨ì´:", timeDiff);
            }
            
            remainingTime = seconds;
            document.getElementById('timer').style.display = 'block';
            document.getElementById('timer').textContent = `ë‚¨ì€ ì‹œê°„: ${Math.floor(remainingTime)}ì´ˆ`;
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                // ì„œë²„ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ë‚¨ì€ ì‹œê°„ ê³„ì‚°
                const elapsedTime = Math.floor((Date.now() - serverTime - timeDiff) / 1000);
                const newRemainingTime = Math.max(0, seconds - elapsedTime);
                
                if (newRemainingTime !== remainingTime) {
                    remainingTime = newRemainingTime;
                    document.getElementById('timer').textContent = `ë‚¨ì€ ì‹œê°„: ${Math.floor(remainingTime)}ì´ˆ`;
                }
                
                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    document.getElementById('timer').style.display = 'none';
                }
            }, 500); // 0.5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
        }

        let _isMobile = false;
        let _isTablet = false;
        let $contentWrapper;

        function hideWidget() {
            window.parent.postMessage({
                type: "WidgetRearrange",
                width: "0px",
                height: "0px",
            }, "*")
            window.parent.focus();
        }

        function revealWidget(moveScrollToBottom = false) {
            if (moveScrollToBottom && $contentWrapper) {
                $contentWrapper.scrollTop = $contentWrapper.scrollHeight;
            }
            if (_isMobile) {
                const rtcAndNotchHeight = 160 + parseInt(getComputedStyle(document.documentElement,).getPropertyValue("--sat"));
                window.parent.postMessage({
                    type: 'WidgetRearrange',
                    anchor: 'middleright',
                    height: '100%',
                    width: '100%',
                    top: `-${parseInt(0)}px`
                }, '*')
            } else {
                window.parent.postMessage({
                    type: "WidgetRearrange",
                    anchor: "middleright",
                    width: `300px`,
                    height: `${document.querySelector('.status-container').offsetHeight+10}px`,
                }, "*")
            }
        }

        function fitTheSize() {
            window.parent.postMessage({
                type: "WidgetRearrange",
                width: document.body.offsetWidth + 10,
                height: document.body.offsetHeight + 10,
            }, "*")
        }

        window.addEventListener('message', function(e) {
            const data = e.data;
            
            if(data.type === "setWidget"){
                _isMobile = data.isMobile;
                _isTablet = data.isTablet;
                if(data.isMobile && !data.isTablet){
                    document.body.classList.add('mobile');
                }else{
                    document.body.classList.remove('mobile');
                }
                hideWidget();
            } else if (data.type === 'init') {
                try {
                    document.body.classList.remove("hidden");
                    revealWidget();
                } catch (error) {
                    alert("An error occurred:", error);
                }
            } else if (data.type === 'initRoleData') {
                // ì„œë²„ì—ì„œ ì „ì†¡í•œ ì—­í•  ë°ì´í„°ë¡œ ì´ˆê¸°í™”
                if (data.roleData) {
                    roleData = data.roleData;
                    console.log("ì„œë²„ì—ì„œ ì—­í•  ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ:", Object.keys(roleData).length);
                }
            } else if (data.type === 'updateGameStatus') {
                console.log("ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸:", data);
                updateGamePhase(data.phase, data.day);
                
                if (data.players) {
                    updatePlayers(data.players);
                }
                
                if (data.myPlayerId) {
                    myPlayerId = data.myPlayerId;
                }
                
                if (data.myRole !== undefined) {
                    updateMyRole(data.myRole);
                }
                
                if (data.timeRemaining) {
                    updateTimer(data.timeRemaining, data.serverTime);
                }
            } else if (data.type === "gameResult") {
                // ê²Œì„ ê²°ê³¼ ì²˜ë¦¬
                console.log("ê²Œì„ ê²°ê³¼ ìˆ˜ì‹ :", data);
                showGameResult(data.winnerTeam);
            } else if (data.type === "hide") {
                hideWidget();
            } else if (data.type === "reveal") {
                revealWidget(true);
            } else if (data.type === "hideWidget") {
                // WidgetManagerì—ì„œ ë³´ë‚´ëŠ” ìˆ¨ê¹€ ë©”ì‹œì§€ ì²˜ë¦¬
                hideWidget();
            } else if (data.type === "showWidget") {
                // WidgetManagerì—ì„œ ë³´ë‚´ëŠ” í‘œì‹œ ë©”ì‹œì§€ ì²˜ë¦¬
                revealWidget();
            }
        });

        window.addEventListener('unload', function () {
            window.parent.focus();
        });

        // ëª¨ë°”ì¼ í™˜ê²½ ê°ì§€
        function checkMobile() {
            if (window.innerWidth <= 768) {
                document.body.classList.add('mobile');
            } else {
                document.body.classList.remove('mobile');
            }
        }

        // ê²Œì„ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜ ì¶”ê°€
        function showGameResult(winnerTeam) {
            const resultElement = document.createElement('div');
            resultElement.style.position = 'fixed';
            resultElement.style.top = '0';
            resultElement.style.left = '0';
            resultElement.style.width = '100%';
            resultElement.style.height = '100%';
            resultElement.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
            resultElement.style.display = 'flex';
            resultElement.style.flexDirection = 'column';
            resultElement.style.justifyContent = 'center';
            resultElement.style.alignItems = 'center';
            resultElement.style.zIndex = '9999';
            resultElement.style.color = '#ffffff';
            resultElement.style.textAlign = 'center';
            resultElement.style.padding = '20px';
            
            const resultTitle = document.createElement('h1');
            resultTitle.textContent = winnerTeam === 'MAFIA' ? 'ë§ˆí”¼ì•„ ìŠ¹ë¦¬!' : 'ì‹œë¯¼ ìŠ¹ë¦¬!';
            resultTitle.style.fontSize = '36px';
            resultTitle.style.marginBottom = '20px';
            resultTitle.style.color = winnerTeam === 'MAFIA' ? '#ff5252' : '#4caf50';
            
            const resultMessage = document.createElement('p');
            resultMessage.textContent = winnerTeam === 'MAFIA' ? 'ë§ˆí”¼ì•„ê°€ ë„ì‹œë¥¼ ì¥ì•…í–ˆìŠµë‹ˆë‹¤!' : 'ì‹œë¯¼ë“¤ì´ ëª¨ë“  ë§ˆí”¼ì•„ë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤!';
            resultMessage.style.fontSize = '18px';
            resultMessage.style.marginBottom = '30px';
            
            const infoMessage = document.createElement('p');
            infoMessage.textContent = 'ì ì‹œ í›„ ëŒ€ê¸°ì‹¤ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤...';
            infoMessage.style.fontSize = '14px';
            infoMessage.style.opacity = '0.8';
            
            resultElement.appendChild(resultTitle);
            resultElement.appendChild(resultMessage);
            resultElement.appendChild(infoMessage);
            
            document.body.appendChild(resultElement);
            
            // 10ì´ˆ í›„ì— ìë™ìœ¼ë¡œ ê²°ê³¼ í™”ë©´ ì œê±°
            setTimeout(() => {
                document.body.removeChild(resultElement);
            }, 10000);
        }

        window.addEventListener('resize', checkMobile);
        checkMobile();
    </script>
</body>

</html> 