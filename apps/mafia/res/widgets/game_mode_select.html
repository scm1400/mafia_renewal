<!DOCTYPE html>
<html style="overflow: hidden">

<head>
    <script>
        /* create style sheet */
        const newFontStylePath = document.URL.includes('https://zep.us') ? "https://cdn-static.zep.us/static/zep-script/css/typography.css" : "https://cdn-static-stage.zep.us/static/zep-script/css/typography.css";

        document.head.appendChild(Object.assign(document.createElement("link"), {
            rel: "stylesheet",
            type: "text/css",
            href: newFontStylePath
        }));
    </script>
    <style type="text/css">
        :root {
            --sat: env(safe-area-inset-top);
            --sar: env(safe-area-inset-right);
            --sab: env(safe-area-inset-bottom);
            --sal: env(safe-area-inset-left);
        }

        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            user-select: none !important;
            font-family: 'Pretendard JP', 'Pretendard', sans-serif, Arial;
            color: #27262E;
        }

        html {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(28, 27, 31, 0.80);
            backdrop-filter: blur(2px);
        }

        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 500px;
            max-width: 100%;
            align-items: center;
            height: max-content;
        }

        .mode-container {
            width: 100%;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        .mode-header {
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
        }

        .mode-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .mode-subtitle {
            font-size: 14px;
            color: #666;
        }

        .mode-list {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .mode-item {
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-radius: 8px;
            background-color: #f5f5f5;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mode-item:hover {
            background-color: #e9e9e9;
        }

        .mode-item.selected {
            background-color: #e0f7fa;
            border: 2px solid #00bcd4;
        }

        .mode-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .mode-item-title {
            font-size: 18px;
            font-weight: 600;
        }

        .mode-item-players {
            font-size: 12px;
            color: #666;
            background-color: #ddd;
            padding: 3px 8px;
            border-radius: 12px;
        }

        .mode-item-description {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }

        .mode-item-jobs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .job-tag {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            background-color: #ddd;
        }

        .job-tag.mafia {
            background-color: #ffcdd2;
            color: #c62828;
        }

        .job-tag.citizen {
            background-color: #bbdefb;
            color: #1565c0;
        }

        .job-tag.neutral {
            background-color: #e6ee9c;
            color: #827717;
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }

        .button {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .button.primary {
            background-color: #00bcd4;
            color: white;
        }

        .button.primary:hover {
            background-color: #00acc1;
        }

        .button.secondary {
            background-color: #e0e0e0;
            color: #333;
        }

        .button.secondary:hover {
            background-color: #d5d5d5;
        }

        .button:disabled {
            background-color: #cccccc;
            color: #888888;
            cursor: not-allowed;
        }
    </style>
</head>

<body>
    <div class="mode-container">
        <div class="mode-header">
            <div class="mode-title">게임 모드 선택</div>
            <div class="mode-subtitle">플레이할 게임 모드를 선택해주세요</div>
        </div>
        <div class="mode-list" id="modeList">
            <!-- 모드 목록이 여기에 동적으로 추가됩니다 -->
        </div>
        <div class="button-container">
            <button class="button secondary" id="cancelButton">취소</button>
            <button class="button primary" id="selectButton" disabled>선택</button>
        </div>
    </div>

    <script>
        let selectedModeId = null;
        let gameModes = [];
        let jobs = [];

        // 모드 아이템 클릭 이벤트 핸들러
        function selectMode(modeId) {
            selectedModeId = modeId;
            
            // 모든 모드 아이템에서 selected 클래스 제거
            document.querySelectorAll('.mode-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // 선택된 모드 아이템에 selected 클래스 추가
            document.getElementById(`mode-${modeId}`).classList.add('selected');
            
            // 선택 버튼 활성화
            document.getElementById('selectButton').disabled = false;
        }

        // 모드 목록 렌더링
        function renderModes(modes, jobsData) {
            const modeList = document.getElementById('modeList');
            modeList.innerHTML = '';
            
            modes.forEach(mode => {
                const modeItem = document.createElement('div');
                modeItem.className = 'mode-item';
                modeItem.id = `mode-${mode.id}`;
                modeItem.onclick = () => selectMode(mode.id);
                
                // 모드 정보 헤더
                const modeHeader = document.createElement('div');
                modeHeader.className = 'mode-item-header';
                
                const modeTitle = document.createElement('div');
                modeTitle.className = 'mode-item-title';
                modeTitle.textContent = mode.name;
                
                const modePlayers = document.createElement('div');
                modePlayers.className = 'mode-item-players';
                modePlayers.textContent = `${mode.minPlayers}~${mode.maxPlayers}명`;
                
                modeHeader.appendChild(modeTitle);
                modeHeader.appendChild(modePlayers);
                
                // 모드 설명
                const modeDesc = document.createElement('div');
                modeDesc.className = 'mode-item-description';
                modeDesc.textContent = mode.description;
                
                // 직업 태그 목록
                const jobsList = document.createElement('div');
                jobsList.className = 'mode-item-jobs';
                
                // 모드에 포함된 직업 태그 생성
                mode.jobIds.forEach(jobId => {
                    const job = jobsData.find(j => j.id === jobId);
                    if (job) {
                        const jobTag = document.createElement('div');
                        jobTag.className = `job-tag ${job.team.toLowerCase()}`;
                        jobTag.textContent = job.name;
                        jobsList.appendChild(jobTag);
                    }
                });
                
                // 모든 요소 추가
                modeItem.appendChild(modeHeader);
                modeItem.appendChild(modeDesc);
                modeItem.appendChild(jobsList);
                
                modeList.appendChild(modeItem);
            });
        }

        // 메시지 수신 처리
        window.addEventListener('message', function(e) {
            const data = e.data;
            
            if (data.type === 'init_game_modes') {
                gameModes = data.modes;
                jobs = data.jobs;
                renderModes(gameModes, jobs);
            }
        });

        // 취소 버튼 클릭 이벤트
        document.getElementById('cancelButton').addEventListener('click', function() {
            parent.sendMessage({
                type: 'cancel_mode_select'
            });
        });

        // 선택 버튼 클릭 이벤트
        document.getElementById('selectButton').addEventListener('click', function() {
            if (selectedModeId) {
                parent.sendMessage({
                    type: 'select_game_mode',
                    modeId: selectedModeId
                });
            }
        });
    </script>
</body>

</html> 